// ⚠️ WARNING: This file is auto-generated by BRRTRouter
// ⚠️ DO NOT MODIFY - Changes will be overwritten on next generation
// ⚠️ To modify API behavior, edit the OpenAPI spec and regenerate
// ⚠️ To implement business logic, edit the corresponding controller file
use brrtrouter::dispatcher::HandlerRequest;
use brrtrouter::typed::TypedHandlerRequest;
use serde::{Deserialize, Serialize};
use std::convert::TryFrom;

#[derive(Debug, Deserialize, Serialize)]
pub struct Request {
    #[serde(rename = "id")]
    pub id: String,
}

#[derive(Debug, Serialize)]

pub struct Response {
    #[serde(rename = "acknowledgment_sent")]
    pub acknowledgment_sent: bool,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "acknowledgment_sent_at")]
    pub acknowledgment_sent_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "company_id")]
    pub company_id: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "created_at")]
    pub created_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "created_by")]
    pub created_by: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "currency_code")]
    pub currency_code: Option<String>,

    #[serde(rename = "document_number")]
    pub document_number: String,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "document_total_amount")]
    pub document_total_amount: Option<rust_decimal::Decimal>,

    #[serde(rename = "document_type")]
    pub document_type: String,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "error_details")]
    pub error_details: Option<serde_json::Value>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "error_message")]
    pub error_message: Option<String>,

    #[serde(rename = "format_id")]
    pub format_id: String,

    #[serde(rename = "id")]
    pub id: String,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "last_retry_at")]
    pub last_retry_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "metadata")]
    pub metadata: Option<serde_json::Value>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "parsed_at")]
    pub parsed_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "parsed_data")]
    pub parsed_data: Option<serde_json::Value>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "processed_at")]
    pub processed_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "raw_content")]
    pub raw_content: Option<String>,

    #[serde(rename = "received_at")]
    pub received_at: String,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "receiver_id")]
    pub receiver_id: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "related_invoice_id")]
    pub related_invoice_id: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "related_purchase_order_id")]
    pub related_purchase_order_id: Option<String>,

    #[serde(rename = "retry_count")]
    pub retry_count: i32,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "sender_id")]
    pub sender_id: Option<String>,

    #[serde(rename = "status")]
    pub status: String,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "updated_at")]
    pub updated_at: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "updated_by")]
    pub updated_by: Option<String>,

    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "validated_at")]
    pub validated_at: Option<String>,
}

impl TryFrom<HandlerRequest> for Request {
    type Error = anyhow::Error;

    fn try_from(req: HandlerRequest) -> Result<Self, Self::Error> {
        use serde_json::{Map, Value};

        let mut data_map = Map::new();

        if let Some(v) = req.get_path_param("id") {
            data_map.insert(
                "id".to_string(),
                brrtrouter::server::request::decode_param_value(
                    v,
                    Some(&serde_json::json!({"format":"uuid","type":"string"})),
                    None,
                    None,
                ),
            );
        } else {
            return Err(anyhow::anyhow!("Missing required parameter 'id'"));
        }

        if let Some(body) = req.body {
            match body {
                Value::Object(map) => {
                    for (k, v) in map {
                        data_map.insert(k, v);
                    }
                }
                other => {
                    data_map.insert("body".to_string(), other);
                }
            }
        }

        Ok(serde_json::from_value(Value::Object(data_map))?)
    }
}

#[allow(dead_code)]
pub fn handler(req: TypedHandlerRequest<Request>) -> Response {
    crate::controllers::get_edi_document::handle(req)
}
