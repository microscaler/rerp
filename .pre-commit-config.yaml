# Pre-commit: https://pre-commit.com
# Install: just init && just install-hooks
# Run manually: pre-commit run --all-files
# Commit message lint (commit-msg): same as CI (commitlint); requires Node and `npm install` at repo root.

repos:
  - repo: local
    hooks:
      - id: commitlint
        name: commitlint (conventional commits, same as CI)
        entry: npx commitlint --edit
        language: system
        stages: [commit-msg]
        pass_filenames: true
      - id: qa
        name: Tooling QA (lint, format-check, tests)
        entry: just qa
        language: system
        pass_filenames: false

      - id: microservices-fmt
        name: Cargo fmt (components+entities) if microservices/ changed
        entry: tooling/.venv/bin/rerp
        args: [pre-commit, microservices-fmt]
        language: system
        pass_filenames: false

      - id: check-empty-print-statements
        name: Check for empty print statements to stderr/stdout
        entry: bash
        args: [
          -c,
          'if grep -rn ''print("", file=sys\.\(stderr\|stdout\)'' tooling/src/ tooling/tests/ 2>/dev/null; then echo "Error: Empty print statements to stderr/stdout are forbidden. Provide descriptive error messages."; exit 1; fi'
        ]
        language: system
        pass_filenames: false
